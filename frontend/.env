import React, { useState, useEffect } from 'react';
import {
  View,
  Text,
  StyleSheet,
  Alert,
  ActivityIndicator,
  ScrollView,
  SafeAreaView,
  TouchableOpacity,
  Animated,
  Easing,
  Dimensions,
} from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { Ionicons } from '@expo/vector-icons';
import axios from 'axios';
import apiConfig from "../config/api";

const { width, height } = Dimensions.get('window');

const ProductDetailsWeatherPage = ({ route, navigation }) => {
  const { productId, productData } = route.params;
  const [product, setProduct] = useState(productData);
  const [loading, setLoading] = useState(!productData);
  const [temperature, setTemperature] = useState(null);
  const [weatherData, setWeatherData] = useState(null);
  const [expiryStatus, setExpiryStatus] = useState('');
  const [weatherLoading, setWeatherLoading] = useState(false);
  const [error, setError] = useState(null);
  const [usingFallback, setUsingFallback] = useState(false);
  
  // Animation values
  const fadeAnim = useState(new Animated.Value(0))[0];
  const slideAnim = useState(new Animated.Value(50))[0];
  const pulseAnim = useState(new Animated.Value(1))[0];

  // Enhanced fallback temperature based on location and season
  const getFallbackTemperature = (location = '') => {
    const locationLower = location.toLowerCase();
    
    // Temperature estimates based on common locations
    const temperatureMap = {
      // Sri Lankan locations
      'colombo': 28, 'kandy': 24, 'galle': 29, 'jaffna': 30, 'negombo': 28,
      'matara': 29, 'anuradhapura': 31, 'trincomalee': 30, 'badulla': 22,
      'rathnapura': 27, 'molagoda': 26,
      
      // International locations
      'london': 15, 'new york': 20, 'tokyo': 18, 'paris': 16, 'dubai': 35,
      'sydney': 22, 'mumbai': 32, 'singapore': 28, 'bangkok': 33
    };

    // Find matching location or use default
    for (const [key, temp] of Object.entries(temperatureMap)) {
      if (locationLower.includes(key)) {
        return temp;
      }
    }

    // Seasonal fallback
    const currentMonth = new Date().getMonth();
    const isSummer = currentMonth >= 4 && currentMonth <= 9;
    return isSummer ? 28 : 22;
  };

  const getWeatherConditionIcon = (condition) => {
    if (!condition) return 'üåà';
    
    const conditionLower = condition.toLowerCase();
    if (conditionLower.includes('clear')) return '‚òÄÔ∏è';
    if (conditionLower.includes('cloud')) return '‚òÅÔ∏è';
    if (conditionLower.includes('rain')) return 'üåßÔ∏è';
    if (conditionLower.includes('drizzle')) return 'üå¶Ô∏è';
    if (conditionLower.includes('thunderstorm')) return '‚õàÔ∏è';
    if (conditionLower.includes('snow')) return '‚ùÑÔ∏è';
    if (conditionLower.includes('mist') || conditionLower.includes('fog')) return 'üå´Ô∏è';
    return 'üåà';
  };

  // Fetch product details only if not passed via params
  const fetchProduct = async () => {
    if (productData) {
      checkExpiryDate(productData.expiry_date);
      await getWeatherData(productData.location);
      startAnimations();
      return;
    }

    try {
      setLoading(true);
      setError(null);
      
      const response = await axios.get(`${apiConfig.baseURL}/products/${productId}`);
      const productData = response.data;
      setProduct(productData);
      
      checkExpiryDate(productData.expiry_date);
      await getWeatherData(productData.location);
      startAnimations();
      
    } catch (error) {
      console.error('Error fetching product', error);
      setError('Failed to load product details');
    } finally {
      setLoading(false);
    }
  };

  // Animation functions
  const startAnimations = () => {
    Animated.parallel([
      Animated.timing(fadeAnim, {
        toValue: 1,
        duration: 800,
        useNativeDriver: true,
        easing: Easing.out(Easing.cubic),
      }),
      Animated.timing(slideAnim, {
        toValue: 0,
        duration: 600,
        useNativeDriver: true,
        easing: Easing.out(Easing.cubic),
      })
    ]).start();

    // Pulse animation for temperature
    if (temperature) {
      Animated.loop(
        Animated.sequence([
          Animated.timing(pulseAnim, {
            toValue: 1.05,
            duration: 1000,
            useNativeDriver: true,
          }),
          Animated.timing(pulseAnim, {
            toValue: 1,
            duration: 1000,
            useNativeDriver: true,
          }),
        ])
      ).start();
    }
  };

  // Get weather data using your API structure
  const getWeatherData = async (location) => {
    try {
      setWeatherLoading(true);
      setUsingFallback(false);
      setError(null);

      console.log('Fetching weather data for:', location);
      
      // Use your API structure with proper error handling
      const response = await axios.get(`https://api.openweathermap.org/data/2.5/weather`, {
        params: {
          q: location,
          appid: apiConfig.weatherAPIKey,
          units: "metric",
        },
      });

      console.log('Weather API response received:', response.data);
      
      const weatherInfo = response.data;
      setWeatherData(weatherInfo);
      
      const currentTemp = Math.round(weatherInfo.main.temp);
      setTemperature(currentTemp);
      
      checkTemperatureAlert(currentTemp);
      
    } catch (error) {
      console.warn('Weather API unavailable, using fallback data:', error.message);
      setError(`Weather service: ${error.response?.data?.message || error.message}. Using estimated data.`);
      setUsingFallback(true);
      
      // Use enhanced fallback data
      const fallbackTemp = getFallbackTemperature(location);
      setTemperature(fallbackTemp);
      checkTemperatureAlert(fallbackTemp);
      
    } finally {
      setWeatherLoading(false);
    }
  };

  const checkTemperatureAlert = (temp) => {
    // Small delay to ensure UI is loaded before showing alert
    setTimeout(() => {
      if (temp > 30) {
        Alert.alert(
          'üî• High Temperature Warning',
          `Current temperature is ${temp}¬∞C. Food may expire quickly in these conditions. Store in cooler environment.`,
          [{ text: 'OK', style: 'default' }]
        );
      } else if (temp > 25 && temp <= 30) {
        Alert.alert(
          'üå°Ô∏è Moderate Temperature',
          `Current temperature is ${temp}¬∞C. Food is in moderate storage conditions. Monitor regularly.`,
          [{ text: 'OK', style: 'default' }]
        );
      }
    }, 1500);
  };

  const checkExpiryDate = (expiryDate) => {
    const today = new Date();
    const expiry = new Date(expiryDate);
    const timeDiff = expiry.getTime() - today.getTime();
    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

    if (daysDiff <= 0) {
      setExpiryStatus('EXPIRED');
      setTimeout(() => {
        Alert.alert(
          '‚ùå Product Expired',
          'This product has expired! Do not consume.',
          [{ text: 'OK', style: 'destructive' }]
        );
      }, 1000);
    } else if (daysDiff <= 5) {
      setExpiryStatus('EXPIRING_SOON');
      setTimeout(() => {
        Alert.alert(
          '‚ö†Ô∏è Expiring Soon',
          `This product will expire in ${daysDiff} day(s). Consume soon!`,
          [{ text: 'OK', style: 'default' }]
        );
      }, 1000);
    } else {
      setExpiryStatus('SAFE');
    }
  };

  const getExpiryStatusInfo = () => {
    switch (expiryStatus) {
      case 'EXPIRED':
        return { 
          color: '#ff4444', 
          bgColor: '#ffebee',
          message: 'Expired', 
          icon: '‚ùå',
          description: 'Do not consume'
        };
      case 'EXPIRING_SOON':
        return { 
          color: '#ff9800', 
          bgColor: '#fff3e0',
          message: 'Expiring Soon', 
          icon: '‚ö†Ô∏è',
          description: 'Consume quickly'
        };
      case 'SAFE':
        return { 
          color: '#4caf50', 
          bgColor: '#e8f5e8',
          message: 'Fresh', 
          icon: '‚úÖ',
          description: 'Safe to consume'
        };
      default:
        return { 
          color: '#666', 
          bgColor: '#f5f5f5',
          message: 'Checking...', 
          icon: '‚è≥',
          description: 'Verifying status'
        };
    }
  };

  const getTemperatureStatusInfo = () => {
    if (temperature === null) {
      return { 
        color: '#666', 
        bgColor: '#f5f5f5',
        message: 'Loading...', 
        icon: '‚è≥',
        description: 'Fetching data'
      };
    }
    
    if (temperature > 30) {
      return { 
        color: '#ff4444', 
        bgColor: '#ffebee',
        message: 'High Risk', 
        icon: 'üî•',
        description: 'Immediate action needed'
      };
    } else if (temperature > 25) {
      return { 
        color: '#ff9800', 
        bgColor: '#fff3e0',
        message: 'Moderate Risk', 
        icon: 'üå°Ô∏è',
        description: 'Monitor closely'
      };
    } else {
      return { 
        color: '#4caf50', 
        bgColor: '#e8f5e8',
        message: 'Low Risk', 
        icon: '‚ùÑÔ∏è',
        description: 'Optimal conditions'
      };
    }
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  };

  const getDaysUntilExpiry = () => {
    if (!product?.expiry_date) return null;
    const today = new Date();
    const expiry = new Date(product.expiry_date);
    const timeDiff = expiry.getTime() - today.getTime();
    return Math.ceil(timeDiff / (1000 * 3600 * 24));
  };

  const retryWeatherData = async () => {
    if (product?.location) {
      setError(null);
      setUsingFallback(false);
      await getWeatherData(product.location);
    }
  };

  useEffect(() => {
    fetchProduct();
  }, []);

  React.useLayoutEffect(() => {
    navigation.setOptions({
      headerStyle: {
        backgroundColor: '#9C27B0',
      },
      headerTintColor: '#fff',
      headerTitleStyle: {
        fontWeight: 'bold',
      },
      title: 'Expiry & Weather',
      headerRight: () => (
        <TouchableOpacity onPress={retryWeatherData} style={styles.headerButton}>
          <Ionicons name="refresh" size={22} color="#fff" />
        </TouchableOpacity>
      ),
    });
  }, [navigation]);

  if (loading) {
    return (
      <LinearGradient colors={['#667eea', '#764ba2']} style={styles.gradient}>
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color="#fff" />
          <Text style={styles.loadingText}>Loading weather details...</Text>
        </View>
      </LinearGradient>
    );
  }

  if (!product) {
    return (
      <LinearGradient colors={['#667eea', '#764ba2']} style={styles.gradient}>
        <View style={styles.errorContainer}>
          <Ionicons name="alert-circle-outline" size={64} color="#fff" />
          <Text style={styles.errorTitle}>Product Not Found</Text>
          <Text style={styles.errorSubtitle}>
            Unable to load product details. Please try again.
          </Text>
          <TouchableOpacity style={styles.retryButton} onPress={fetchProduct}>
            <Text style={styles.retryButtonText}>Try Again</Text>
          </TouchableOpacity>
        </View>
      </LinearGradient>
    );
  }

  const expiryInfo = getExpiryStatusInfo();
  const tempInfo = getTemperatureStatusInfo();
  const daysUntilExpiry = getDaysUntilExpiry();
  const weatherCondition = weatherData?.weather?.[0]?.main;
  const weatherIcon = getWeatherConditionIcon(weatherCondition);
  const humidity = weatherData?.main?.humidity;

  return (
    <LinearGradient colors={['#667eea', '#764ba2']} style={styles.gradient}>
      <SafeAreaView style={styles.container}>
        
        {/* Enhanced Weather Header */}
        <Animated.View 
          style={[
            styles.weatherHeader,
            {
              opacity: fadeAnim,
              transform: [{ translateY: slideAnim }]
            }
          ]}
        >
          <LinearGradient
            colors={['rgba(255,255,255,0.2)', 'rgba(255,255,255,0.1)']}
            style={styles.weatherHeaderGradient}
          >
            <View style={styles.weatherTopRow}>
              <View style={styles.locationContainer}>
                <Ionicons name="location" size={20} color="#fff" />
                <Text style={styles.locationText}>{product.location}</Text>
              </View>
              
              {usingFallback && (
                <View style={styles.fallbackBadge}>
                  <Ionicons name="cloud-offline" size={14} color="#fff" />
                  <Text style={styles.fallbackText}>Offline</Text>
                </View>
              )}
            </View>
            
            <View style={styles.weatherMain}>
              {temperature !== null && (
                <Animated.View style={[styles.temperatureMain, { transform: [{ scale: pulseAnim }] }]}>
                  <Text style={styles.weatherIcon}>{weatherIcon}</Text>
                  <View>
                    <Text style={styles.temperature}>{temperature}¬∞C</Text>
                    <Text style={styles.weatherCondition}>
                      {usingFallback ? 'Estimated Data' : weatherCondition || 'Clear'}
                    </Text>
                  </View>
                </Animated.View>
              )}
              
              {humidity && !usingFallback && (
                <View style={styles.weatherDetails}>
                  <View style={styles.weatherDetailItem}>
                    <Ionicons name="water" size={14} color="#fff" />
                    <Text style={styles.weatherDetailText}>{humidity}%</Text>
                  </View>
                  <Text style={styles.weatherSource}>Live data</Text>
                </View>
              )}
            </View>

            {weatherLoading && (
              <View style={styles.weatherLoading}>
                <ActivityIndicator size="small" color="#fff" />
                <Text style={styles.weatherLoadingText}>Fetching live data...</Text>
              </View>
            )}
          </LinearGradient>
        </Animated.View>

        <ScrollView 
          style={styles.scrollView}
          showsVerticalScrollIndicator={false}
          contentContainerStyle={styles.scrollContent}
        >
          
          {/* Success Banner when using real API */}
          {!usingFallback && temperature && (
            <Animated.View 
              style={[
                styles.successBanner,
                {
                  opacity: fadeAnim,
                  transform: [{ translateY: slideAnim }]
                }
              ]}
            >
              <Ionicons name="checkmark-circle" size={20} color="#2e7d32" />
              <View style={styles.successBannerContent}>
                <Text style={styles.successBannerText}>Live weather data connected!</Text>
                <Text style={styles.successBannerSubtext}>Real-time temperature monitoring active</Text>
              </View>
            </Animated.View>
          )}

          {/* Error Banner for fallback */}
          {usingFallback && (
            <Animated.View 
              style={[
                styles.errorBanner,
                {
                  opacity: fadeAnim,
                  transform: [{ translateY: slideAnim }]
                }
              ]}
            >
              <Ionicons name="information-circle" size={20} color="#856404" />
              <View style={styles.errorBannerContent}>
                <Text style={styles.errorBannerText}>Using estimated temperature data</Text>
                <Text style={styles.errorBannerSubtext}>
                  Intelligent estimates based on location patterns
                </Text>
              </View>
              <TouchableOpacity onPress={retryWeatherData} style={styles.retrySmallButton}>
                <Text style={styles.retrySmallText}>Retry</Text>
              </TouchableOpacity>
            </Animated.View>
          )}

          {/* Product Card */}
          <Animated.View 
            style={[
              styles.productCard,
              {
                opacity: fadeAnim,
                transform: [{ translateY: slideAnim }]
              }
            ]}
          >
            <LinearGradient
              colors={['#ffffff', '#f8f9fa']}
              style={styles.productCardGradient}
            >
              <View style={styles.productHeader}>
                <View style={styles.productIconContainer}>
                  <Text style={styles.productIcon}>üì¶</Text>
                </View>
                <View style={styles.productInfo}>
                  <Text style={styles.productName}>{product.name}</Text>
                  <Text style={styles.productBatch}>{product.batch_code}</Text>
                  <Text style={styles.productCategory}>{product.category}</Text>
                </View>
              </View>

              <View style={styles.productDetails}>
                <View style={styles.detailItem}>
                  <Ionicons name="navigate" size={16} color="#666" />
                  <Text style={styles.detailLabel}>Origin: </Text>
                  <Text style={styles.detailValue}>{product.origin}</Text>
                </View>
                {product.description && (
                  <View style={styles.detailItem}>
                    <Ionicons name="document-text" size={16} color="#666" />
                    <Text style={styles.detailLabel}>Description: </Text>
                    <Text style={styles.detailValue}>{product.description}</Text>
                  </View>
                )}
              </View>
            </LinearGradient>
          </Animated.View>

          {/* Status Cards */}
          <View style={styles.statusGrid}>
            {/* Expiry Status */}
            <Animated.View 
              style={[
                styles.statusCard,
                { backgroundColor: expiryInfo.bgColor },
                {
                  opacity: fadeAnim,
                  transform: [{ translateY: slideAnim }]
                }
              ]}
            >
              <View style={styles.statusHeader}>
                <Text style={styles.statusIcon}>{expiryInfo.icon}</Text>
                <View style={styles.statusTextContainer}>
                  <Text style={styles.statusTitle}>Expiry Status</Text>
                  <Text style={[styles.statusValue, { color: expiryInfo.color }]}>
                    {expiryInfo.message}
                  </Text>
                </View>
              </View>
              <Text style={styles.statusDescription}>{expiryInfo.description}</Text>
              
              {daysUntilExpiry !== null && (
                <View style={styles.expiryCountdown}>
                  <Ionicons name="calendar" size={16} color={expiryInfo.color} />
                  <Text style={[styles.expiryText, { color: expiryInfo.color }]}>
                    {daysUntilExpiry > 0 ? `${daysUntilExpiry} days left` : 'Expired'}
                  </Text>
                </View>
              )}
            </Animated.View>

            {/* Temperature Status */}
            <Animated.View 
              style={[
                styles.statusCard,
                { backgroundColor: tempInfo.bgColor },
                {
                  opacity: fadeAnim,
                  transform: [{ translateY: slideAnim }]
                }
              ]}
            >
              <View style={styles.statusHeader}>
                <Text style={styles.statusIcon}>{tempInfo.icon}</Text>
                <View style={styles.statusTextContainer}>
                  <Text style={styles.statusTitle}>Temperature Risk</Text>
                  <Text style={[styles.statusValue, { color: tempInfo.color }]}>
                    {tempInfo.message}
                  </Text>
                </View>
              </View>
              <Text style={styles.statusDescription}>{tempInfo.description}</Text>
              
              <View style={styles.temperatureDisplay}>
                <Ionicons name="thermometer" size={16} color={tempInfo.color} />
                <Text style={[styles.temperatureValue, { color: tempInfo.color }]}>
                  {temperature}¬∞C {usingFallback && '(Estimated)'}
                </Text>
              </View>
            </Animated.View>
          </View>

          {/* Storage Guidelines */}
          <Animated.View 
            style={[
              styles.guidelinesCard,
              {
                opacity: fadeAnim,
                transform: [{ translateY: slideAnim }]
              }
            ]}
          >
            <View style={styles.guidelinesHeader}>
              <Ionicons name="restaurant" size={24} color="#9C27B0" />
              <Text style={styles.guidelinesTitle}>Storage Guidelines</Text>
            </View>
            
            {temperature !== null && (
              <View style={styles.guidelineItem}>
                <View style={[
                  styles.guidelineIcon,
                  temperature > 30 ? styles.highRisk : 
                  temperature > 25 ? styles.mediumRisk : styles.lowRisk
                ]}>
                  <Text style={styles.guidelineEmoji}>
                    {temperature > 30 ? 'üî•' : temperature > 25 ? 'üå°Ô∏è' : '‚ùÑÔ∏è'}
                  </Text>
                </View>
                <View style={styles.guidelineContent}>
                  <Text style={styles.guidelineTitle}>
                    {temperature > 30 ? 'High Temperature Alert' : 
                     temperature > 25 ? 'Moderate Conditions' : 'Optimal Conditions'}
                  </Text>
                  <Text style={styles.guidelineText}>
                    {temperature > 30 
                      ? 'Store immediately in refrigerator. Consume within 1-2 days. Avoid direct sunlight.'
                      : temperature > 25
                      ? 'Monitor food quality regularly. Recommended to refrigerate for longer shelf life.'
                      : 'Ideal storage conditions. Follow standard storage guidelines.'}
                  </Text>
                </View>
              </View>
            )}

            <View style={styles.guidelineItem}>
              <View style={[styles.guidelineIcon, styles.expiryIcon]}>
                <Text style={styles.guidelineEmoji}>üìÖ</Text>
              </View>
              <View style={styles.guidelineContent}>
                <Text style={styles.guidelineTitle}>Expiry Management</Text>
                <Text style={styles.guidelineText}>
                  {expiryStatus === 'EXPIRED' 
                    ? 'This product has expired and should not be consumed for safety reasons.'
                    : expiryStatus === 'EXPIRING_SOON'
                    ? 'Product is nearing expiry date. Prioritize consumption this week.'
                    : 'Product is within safe consumption period. Store properly.'}
                </Text>
              </View>
            </View>
          </Animated.View>

          {/* Data Source Info */}
          <Animated.View 
            style={[
              styles.infoCard,
              {
                opacity: fadeAnim,
                transform: [{ translateY: slideAnim }]
              }
            ]}
          >
            <Ionicons name="information-circle" size={20} color="#2196F3" />
            <View style={styles.infoContent}>
              <Text style={styles.infoTitle}>
                {usingFallback ? 'Estimated Data' : 'Live Weather Data'}
              </Text>
              <Text style={styles.infoText}>
                {usingFallback 
                  ? 'Temperature estimates are based on location patterns and seasonal data for reliable guidance.'
                  : 'Real-time temperature and humidity data provided by OpenWeatherMap API.'
                }
              </Text>
            </View>
          </Animated.View>

          {/* Footer */}
          <View style={styles.footer}>
            <Text style={styles.footerText}>
              Product updated: {new Date(product.updated_at).toLocaleDateString()}
            </Text>
            <Text style={styles.footerNote}>
              {usingFallback 
                ? 'üìç Estimated temperature data'
                : 'üå§Ô∏è Live weather data from OpenWeatherMap'
              }
            </Text>
          </View>
        </ScrollView>
      </SafeAreaView>
    </LinearGradient>
  );
};

const styles = StyleSheet.create({
  gradient: {
    flex: 1,
  },
  container: {
    flex: 1,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    marginTop: 16,
    fontSize: 16,
    color: '#fff',
    fontWeight: '600',
  },
  errorContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 40,
  },
  errorTitle: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#fff',
    marginTop: 16,
    marginBottom: 8,
  },
  errorSubtitle: {
    fontSize: 16,
    color: 'rgba(255,255,255,0.8)',
    textAlign: 'center',
    marginBottom: 24,
    lineHeight: 22,
  },
  retryButton: {
    backgroundColor: 'rgba(255,255,255,0.2)',
    paddingHorizontal: 24,
    paddingVertical: 12,
    borderRadius: 25,
    borderWidth: 1,
    borderColor: 'rgba(255,255,255,0.3)',
  },
  retryButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: '600',
  },
  headerButton: {
    paddingHorizontal: 16,
  },
  weatherHeader: {
    paddingHorizontal: 20,
    paddingTop: 20,
    paddingBottom: 10,
  },
  weatherHeaderGradient: {
    borderRadius: 20,
    padding: 20,
    borderWidth: 1,
    borderColor: 'rgba(255,255,255,0.2)',
  },
  weatherTopRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 15,
  },
  locationContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    flex: 1,
  },
  locationText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: '600',
    marginLeft: 8,
  },
  fallbackBadge: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: 'rgba(255,255,255,0.2)',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 12,
  },
  fallbackText: {
    color: '#fff',
    fontSize: 12,
    fontWeight: '500',
    marginLeft: 4,
  },
  weatherMain: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
  },
  temperatureMain: {
    alignItems: 'center',
    flexDirection: 'row',
  },
  weatherIcon: {
    fontSize: 32,
    marginRight: 12,
  },
  temperature: {
    color: '#fff',
    fontSize: 36,
    fontWeight: 'bold',
  },
  weatherCondition: {
    color: 'rgba(255,255,255,0.9)',
    fontSize: 14,
    marginTop: 4,
  },
  weatherDetails: {
    alignItems: 'flex-end',
  },
  weatherDetailItem: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 4,
  },
  weatherDetailText: {
    color: '#fff',
    fontSize: 14,
    marginLeft: 4,
  },
  weatherSource: {
    color: 'rgba(255,255,255,0.7)',
    fontSize: 12,
  },
  weatherLoading: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    marginTop: 10,
    paddingTop: 10,
    borderTopWidth: 1,
    borderTopColor: 'rgba(255,255,255,0.2)',
  },
  weatherLoadingText: {
    color: 'rgba(255,255,255,0.8)',
    fontSize: 12,
    marginLeft: 6,
  },
  scrollView: {
    flex: 1,
  },
  scrollContent: {
    padding: 16,
    paddingTop: 0,
  },
  successBanner: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#e8f5e8',
    padding: 12,
    borderRadius: 12,
    marginBottom: 16,
    borderLeftWidth: 4,
    borderLeftColor: '#4caf50',
  },
  successBannerContent: {
    flex: 1,
    marginLeft: 8,
  },
  successBannerText: {
    color: '#2e7d32',
    fontSize: 14,
    fontWeight: '500',
  },
  successBannerSubtext: {
    color: '#2e7d32',
    fontSize: 12,
    marginTop: 2,
    opacity: 0.8,
  },
  errorBanner: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#fff3cd',
    padding: 12,
    borderRadius: 12,
    marginBottom: 16,
    borderLeftWidth: 4,
    borderLeftColor: '#ffc107',
  },
  errorBannerContent: {
    flex: 1,
    marginLeft: 8,
  },
  errorBannerText: {
    color: '#856404',
    fontSize: 14,
    fontWeight: '500',
  },
  errorBannerSubtext: {
    color: '#856404',
    fontSize: 12,
    marginTop: 2,
    opacity: 0.8,
  },
  retrySmallButton: {
    backgroundColor: '#ffc107',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 8,
  },
  retrySmallText: {
    color: '#856404',
    fontSize: 12,
    fontWeight: '600',
  },
  productCard: {
    borderRadius: 20,
    marginBottom: 16,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 10 },
    shadowOpacity: 0.1,
    shadowRadius: 20,
    elevation: 10,
  },
  productCardGradient: {
    borderRadius: 20,
    padding: 20,
  },
  productHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 16,
  },
  productIconContainer: {
    width: 50,
    height: 50,
    borderRadius: 25,
    backgroundColor: '#667eea',
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 16,
  },
  productIcon: {
    fontSize: 24,
  },
  productInfo: {
    flex: 1,
  },
  productName: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#2d3748',
    marginBottom: 4,
  },
  productBatch: {
    fontSize: 14,
    color: '#718096',
    fontFamily: 'monospace',
    marginBottom: 2,
  },
  productCategory: {
    fontSize: 12,
    color: '#667eea',
    fontWeight: '600',
    backgroundColor: '#e9d8fd',
    paddingHorizontal: 8,
    paddingVertical: 2,
    borderRadius: 12,
    alignSelf: 'flex-start',
  },
  productDetails: {
    borderTopWidth: 1,
    borderTopColor: '#e2e8f0',
    paddingTop: 12,
  },
  detailItem: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  detailLabel: {
    fontSize: 12,
    color: '#718096',
    fontWeight: '500',
    marginLeft: 6,
    marginRight: 4,
  },
  detailValue: {
    fontSize: 12,
    color: '#4a5568',
    flex: 1,
  },
  statusGrid: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 16,
    gap: 12,
  },
  statusCard: {
    flex: 1,
    borderRadius: 16,
    padding: 16,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.1,
    shadowRadius: 12,
    elevation: 5,
  },
  statusHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  statusTextContainer: {
    flex: 1,
  },
  statusIcon: {
    fontSize: 24,
    marginRight: 12,
  },
  statusTitle: {
    fontSize: 12,
    color: '#718096',
    fontWeight: '600',
    marginBottom: 2,
  },
  statusValue: {
    fontSize: 16,
    fontWeight: 'bold',
  },
  statusDescription: {
    fontSize: 12,
    color: '#4a5568',
    marginBottom: 12,
  },
  expiryCountdown: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: 'rgba(255,255,255,0.5)',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
    alignSelf: 'flex-start',
  },
  expiryText: {
    fontSize: 11,
    fontWeight: '600',
    marginLeft: 4,
  },
  temperatureDisplay: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: 'rgba(255,255,255,0.5)',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
    alignSelf: 'flex-start',
  },
  temperatureValue: {
    fontSize: 11,
    fontWeight: '600',
    marginLeft: 4,
  },
  guidelinesCard: {
    backgroundColor: '#fff',
    borderRadius: 20,
    padding: 20,
    marginBottom: 16,
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.1,
    shadowRadius: 12,
    elevation: 5,
  },
  guidelinesHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 16,
  },
  guidelinesTitle: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#2d3748',
    marginLeft: 8,
  },
  guidelineItem: {
    flexDirection: 'row',
    alignItems: 'flex-start',
    marginBottom: 16,
    padding: 12,
    backgroundColor: '#f7fafc',
    borderRadius: 12,
  },
  guidelineIcon: {
    width: 40,
    height: 40,
    borderRadius: 20,
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 12,
  },
  highRisk: {
    backgroundColor: '#fed7d7',
  },
  mediumRisk: {
    backgroundColor: '#feebc8',
  },
  lowRisk: {
    backgroundColor: '#c6f6d5',
  },
  expiryIcon: {
    backgroundColor: '#e9d8fd',
  },
  guidelineEmoji: {
    fontSize: 18,
  },
  guidelineContent: {
    flex: 1,
  },
  guidelineTitle: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#2d3748',
    marginBottom: 4,
  },
  guidelineText: {
    fontSize: 13,
    color: '#4a5568',
    lineHeight: 18,
  },
  infoCard: {
    flexDirection: 'row',
    alignItems: 'flex-start',
    backgroundColor: '#e3f2fd',
    padding: 16,
    borderRadius: 12,
    marginBottom: 16,
  },
  infoContent: {
    flex: 1,
    marginLeft: 12,
  },
  infoTitle: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#1976d2',
    marginBottom: 4,
  },
  infoText: {
    fontSize: 12,
    color: '#1976d2',
    lineHeight: 16,
  },
  footer: {
    alignItems: 'center',
    padding: 16,
    marginBottom: 20,
  },
  footerText: {
    fontSize: 12,
    color: 'rgba(255,255,255,0.7)',
    textAlign: 'center',
    marginBottom: 4,
  },
  footerNote: {
    fontSize: 11,
    color: 'rgba(255,255,255,0.5)',
    textAlign: 'center',
    fontStyle: 'italic',
  },
});

export default ProductDetailsWeatherPage;